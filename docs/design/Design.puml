@startuml
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam handwritten false
skinparam packageStyle rectangle
top to bottom direction

package com.comp2042.app {
    class Main
    class StartMenuController
    class SettingsController
    class ModeSelectController
    class HelpDialogController
    class HelpDialogService
    
    Main -[hidden]down-> StartMenuController
    StartMenuController -[hidden]down-> SettingsController
    SettingsController -[hidden]down-> ModeSelectController
    ModeSelectController -[hidden]down-> HelpDialogController
    HelpDialogController -[hidden]down-> HelpDialogService
}

package com.comp2042.ui {
    class GuiController
    class HudPanel
    class NextQueuePanel
    class NotificationPanel
    class GameOverPanel
    class BrickColorPalette
    package anim {
        class TetrisLogoView
    }
    package input {
        class AutoRepeatHandler
    }

    ' Force vertical stacking in UI package
    GuiController -[hidden]down-> HudPanel
    HudPanel -[hidden]down-> NextQueuePanel
    NextQueuePanel -[hidden]down-> NotificationPanel
    NotificationPanel -[hidden]down-> GameOverPanel
    GameOverPanel -[hidden]down-> BrickColorPalette
    BrickColorPalette -[hidden]down-> anim
    anim -[hidden]down-> input
}

package com.comp2042.game {
    class GameController
    class GameLogic
    class GameConfig
    enum GameState
    class LevelProgression
    class Score
    class LineClearStats
    enum LineClearType
    package stats {
        class HighScoreEntry
        class HighScoreService
    }

    ' Force vertical stacking in Game package
    GameController -[hidden]down-> GameLogic
    GameLogic -[hidden]down-> GameConfig
    GameConfig -[hidden]down-> GameState
    GameState -[hidden]down-> LevelProgression
    LevelProgression -[hidden]down-> Score
    Score -[hidden]down-> LineClearStats
    LineClearStats -[hidden]down-> LineClearType
    LineClearType -[hidden]down-> stats
}

package com.comp2042.board {
    interface Board
    class SimpleBoard
    class BrickRotator
    class MatrixOperations
    class ViewData
    class ClearRow
    class NextShapeInfo

    ' Force vertical stacking in Board package
    Board -[hidden]down-> SimpleBoard
    SimpleBoard -[hidden]down-> BrickRotator
    BrickRotator -[hidden]down-> MatrixOperations
    MatrixOperations -[hidden]down-> ViewData
    ViewData -[hidden]down-> ClearRow
    ClearRow -[hidden]down-> NextShapeInfo
}

package com.comp2042.logic.bricks {
    interface Brick
    interface BrickGenerator
    class PieceGenerator
    enum TetrominoType
    class IBrick
    class JBrick
    class LBrick
    class OBrick
    class SBrick
    class TBrick
    class ZBrick
}

package com.comp2042.config {
    class GameSettings
    class GameSettingsStore
    class ResourceManager
}

package com.comp2042.audio {
    class BackgroundMusicManager
}

package com.comp2042.help {
    class HelpContentProvider
}

' Global Layout Hints (Force Vertical Stack of Packages)
com.comp2042.app -[hidden]down-> com.comp2042.ui
com.comp2042.ui -[hidden]down-> com.comp2042.game
com.comp2042.game -[hidden]down-> com.comp2042.board
com.comp2042.board -[hidden]down-> com.comp2042.logic.bricks
com.comp2042.logic.bricks -[hidden]down-> com.comp2042.config
com.comp2042.config -[hidden]down-> com.comp2042.audio
com.comp2042.audio -[hidden]down-> com.comp2042.help

' Relationships with Multiplicity

Main ..> StartMenuController : creates >
StartMenuController "1" o-- "1" GameConfig
StartMenuController "1" o-- "1" GameSettingsStore
StartMenuController ..> BackgroundMusicManager : uses >
StartMenuController ..> HighScoreService : uses >
StartMenuController ..> HelpContentProvider : uses >
StartMenuController ..> TetrisLogoView : uses >
StartMenuController ..> SettingsController : opens >
StartMenuController ..> ModeSelectController : opens >
StartMenuController ..> HelpDialogService : uses >
StartMenuController ..> GameController : creates >

GameController "1" *-- "1" GameLogic
GameController "1" o-- "1" GameConfig
GameController "1" o-- "1" GameSettings
GameController "1" o-- "1" GuiController

GameLogic "1" *-- "1" Board
GameLogic "1" *-- "1" LevelProgression
GameLogic "1" *-- "1" Score
GameLogic "1" *-- "1" LineClearStats

SimpleBoard ..|> Board
SimpleBoard "1" *-- "1" BrickRotator
SimpleBoard "1" *-- "1" BrickGenerator
SimpleBoard "1" o-- "1" Score

BrickRotator "1" o-- "1" Brick
BrickRotator ..> MatrixOperations : uses >

PieceGenerator ..|> BrickGenerator
PieceGenerator ..> Brick : produces >

IBrick ..|> Brick
JBrick ..|> Brick
LBrick ..|> Brick
OBrick ..|> Brick
SBrick ..|> Brick
TBrick ..|> Brick
ZBrick ..|> Brick

Brick "1" *-- "1" TetrominoType

GuiController "1" *-- "1" HudPanel
GuiController "1" *-- "1" NextQueuePanel
GuiController "1" *-- "1" NotificationPanel
GuiController "1" *-- "1" GameOverPanel
GuiController "1" *-- "1" AutoRepeatHandler
GuiController ..> Board : reads >
GuiController ..> ViewData : reads >

HudPanel ..> BrickColorPalette : uses >
NextQueuePanel ..> BrickColorPalette : uses >

SettingsController ..> GameSettings : modifies >
SettingsController ..> GameSettingsStore : uses >

@enduml
